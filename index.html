<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="overview">
        <div id="weather">
            <svg id="weather-icon" height="100" width="100">
                <use xlink:href="/icons/_icons.svg#sun"></use>
            </svg>

            <h4 id="weather-label" class="overview-label">?</h4>
        </div>

        <div id="temp">
            <svg id="temp-icon" version="1.1" height="100" width="100" viewBox="0 0 100 100"
                xmlns="http://www.w3.org/2000/svg">
                <g transform="translate(0 -270.54)">
                    <path transform="translate(0 270.54)"
                        d="m50 15c-5.54 0-10 4.46-10 10v33.844a15 15 0 0 0-5 11.156 15 15 0 0 0 15 15 15 15 0 0 0 15-15 15 15 0 0 0-5-11.16v-33.84c0-5.54-4.46-10-10-10z"
                        fill="none" stroke="#000018" stroke-width="1.0016" />
                    <rect id="bar" x="45" y="290.54" width="10" height="45" ry="5" fill="#00f" />
                    <circle id="circle" cx="50" cy="340.54" r="10" fill="#00f" />
                    <g fill="none" stroke="#000" stroke-width="1px">
                        <path d="m60 300.54h5" />
                        <path d="m60 310.54h5" />
                        <path d="m60 320.54h5" />
                    </g>
                </g>
            </svg>

            <h4 id="temp-label" class="overview-label">? °C</h4>
        </div>

        <div id="wind">
            <svg id="wind-icon" height="100" width="100">
                <use xlink:href="/icons/_icons.svg#wind">
                </use>
            </svg>

            <h4 id="wind-label" class="overview-label">? Bft</h4>
        </div>
    </div>

    <div id="forecast">
        <h1 id="forecast-title">Verwachtingen 7 dagen</h1>

        <ul id="forecast-controls">
            <li class="forecast-control-active">Max Temp</li>
            <li>Min temp</li>
            <li>Neerslag</li>
            <li>Wind</li>
        </ul>

        <svg id="forecast-chart" version="1.1" viewBox="0 0 450 150" xmlns="http://www.w3.org/2000/svg"></svg>
    </div>

    <script>
        var updateWeather = function (icon, description) {
            var weatherIcon = document.querySelector("#weather-icon use");
            var weatherLabel = document.querySelector("#weather-label");

            weatherIcon.setAttributeNS("http://www.w3.org/1999/xlink", "xlink:href", "/icons/_icons.svg#" + icon);
            weatherLabel.textContent = description;
        }

        var updateTemperature = function (temperature) {
            var tempIcon = document.querySelector("#temp-icon #bar");
            var tempCircle = document.querySelector("#temp-icon #circle");
            var tempLabel = document.querySelector("#temp-label");

            var maxTemp = 30;
            var minTemp = 0;
            var tempIconC = tempIcon.getBBox();
            var tempIconXOrigin = tempIconC.x + tempIconC.width;
            var tempIconYOrigin = tempIconC.y + tempIconC.height;
            var tempPercentage = temperature / (maxTemp - minTemp);
            var scalePercentage = (tempPercentage / 1.2) + (1 - (1 / 1.2));
            var fColor;

            tempIcon.style.transformOrigin = tempIconXOrigin + "px " + tempIconYOrigin + "px";
            tempIcon.style.transform = "scaleY(" + scalePercentage + ")";
            tempIcon.style.transition = "transform 2s ease, fill  1s ease";
            tempCircle.style.transition = "transform 2s ease, fill  1s ease";

            if (temperature <= (maxTemp / 3)) {
                fColor = "blue";
            }
            else if (temperature > (maxTemp / 3) && temperature < (maxTemp / 3) * 2) {
                fColor = "orange";
            }
            else if (temperature >= (maxTemp / 3) * 2) {
                fColor = "red";
            }
            tempIcon.style.fill = fColor;
            tempCircle.style.fill = fColor;
            tempLabel.textContent = temperature + "°C";
        }

        var updateWind = function (direction, description) {
            var windIcon = document.querySelector("#wind-icon use");
            var windLabel = document.querySelector("#wind-label");

            windIcon.style.transformOrigin = "center";
            windIcon.style.transition = "transform 2s ease";
            windIcon.style.transform = "rotate(" + direction + "deg)";
            windLabel.textContent = description;
        }

        var updateChart = function (data, type) {
            var forecastChart = document.querySelector("#forecast-chart");

            // Clear
            forecastChart.innerHTML = "";

            var viewBox = forecastChart.viewBox.baseVal;
            var chartPosition = { xMin: 45, xMax: viewBox.width - 15, yMin: 15, yMax: viewBox.height - 45 };
                xSubdivide = data.length,
                ySubdivide = 5,
                scale = { min: Math.floor(Math.min(...data.map(x => x.value)) / 5) * 5, max: Math.ceil(Math.max(...data.map(x => x.value)) / 5) * 5 };
            columnWidth = (chartPosition.xMax - chartPosition.xMin) / xSubdivide;

            for (let i = 0; i < ySubdivide; i++) {
                // Horizontal lines
                var path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                var x = chartPosition.xMin;
                var y = (i - 0) * (chartPosition.yMax - chartPosition.yMin) / ((ySubdivide - 1) - 0) + chartPosition.yMin;
                var l = chartPosition.xMax - chartPosition.xMin;

                path.style.stroke = "909090";
                path.style.strokeWidth = "0.5";
                path.style.fill = "none";
                path.setAttribute("d", "m" + x + " " + y + "h" + l);

                forecastChart.append(path);

                // Y axis
                var text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                var x = chartPosition.xMin - 40;
                var y = (chartPosition.yMax - chartPosition.yMin) - (i - 0) * (chartPosition.yMax - chartPosition.yMin) / ((ySubdivide - 1) - 0) + chartPosition.yMin;

                text.textContent = ((scale.max - scale.min) / (ySubdivide - 1)) * i + scale.min  + type;
                text.setAttribute("font-size", "10");
                text.setAttribute("x", x);
                text.setAttribute("y", y + 3.5);

                forecastChart.append(text);
            }

            var d = "M ";
            var path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.style.stroke = "black";
            path.style.strokeWidth = "1.0";
            path.style.fill = "none";
            path.style.strokeDasharray = "650";
            path.style.animation = "dash 2s ease";

            for (let i = 0; i < xSubdivide; i++) {
                // X axis
                var text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.textContent = data[i].date;
                text.setAttribute("font-size", "10");

                var x = (chartPosition.xMin + columnWidth / 3) + (columnWidth * i);
                var y = chartPosition.yMax + 25;

                text.setAttribute("x", x);
                text.setAttribute("y", y);

                forecastChart.append(text);

                // Line
                var x = (chartPosition.xMin + columnWidth / 2) + (columnWidth * i);
                var y = (chartPosition.yMax - chartPosition.yMin) - (data[i].value - scale.min) * (chartPosition.yMax - chartPosition.yMin) / (scale.max - scale.min) + chartPosition.yMin;

                if (i === 0) {
                    d += x + " " + y;
                } else {
                    d += " L " + x + " " + y;
                }

                var circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("r", 2.5);
                circle.setAttribute("cx", x);
                circle.setAttribute("cy", y);

                var title = document.createElementNS("http://www.w3.org/2000/svg", "title");
                title.textContent = data[i].date + "\n" + data[i].value + type;

                circle.append(title);
                forecastChart.append(circle);
            }

            path.setAttribute("d", d);
            forecastChart.prepend(path);
        }

        var init = function () {
            updateWeather("sun-overcast", "Slightly overcast");
            updateTemperature(Math.round(Math.random() * 30));
            updateWind(Math.round(Math.random() * 360), Math.round(Math.random() * 5) + " Bft");
            updateChart([
                { date: "1/01", value: Math.round(Math.random() * 30) },
                { date: "2/01", value: Math.round(Math.random() * 30) },
                { date: "3/01", value: Math.round(Math.random() * 30) },
                { date: "4/01", value: Math.round(Math.random() * 30) },
                { date: "5/01", value: Math.round(Math.random() * 30) },
                { date: "6/01", value: Math.round(Math.random() * 30) },
                { date: "7/01", value: Math.round(Math.random() * 30) }
            ], "°C");
        }

        init();

        setInterval(() => {
            init();
        }, 10000);
    </script>
</body>

</html>